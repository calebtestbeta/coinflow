<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- Google tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KQZ8K34TCP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KQZ8K34TCP');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>WAYFARER CALCULATOR</title>
    <meta name="description" content="å°ˆç‚ºæ—…è¡Œè€…è¨­è¨ˆçš„æ¥µç°¡åŒ¯ç‡è¨ˆç®—æ©Ÿã€‚æ”¯æ´å¤šåœ‹è²¨å¹£å³æ™‚æ›ç®—ã€ç®—å¼ç´¯åŠ èˆ‡æ­·å²ç´€éŒ„ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:title" content="WAYFARER CALCULATOR">
    <meta property="og:description" content="æ—…è¡Œã€ä»£è³¼çš„å¥½å¹«æ‰‹ï¼æ”¯æ´ç®—å¼è¼¸å…¥ã€å³æ™‚å¤šåœ‹åŒ¯ç‡è½‰æ›ã€‚">
    <!-- æ›´æ–° SEO é è¦½åœ–ç‰‡ -->
    <meta property="og:image" content="https://calebtestbeta.github.io/coinflow/preview.png">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='24' fill='%230ea5e9'/%3E%3Cpath d='M22 34 L38 74 L50 48 L62 74 L78 34' fill='none' stroke='white' stroke-width='8' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%230ea5e9'/%3E%3Cpath d='M22 34 L38 74 L50 48 L62 74 L78 34' fill='none' stroke='white' stroke-width='8' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/currency.js@2.0.4/dist/currency.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        dark: {
                            bg: '#000000',
                            card: '#1c1c1e',
                            btn: '#2c2c2e',
                            text: '#ffffff',
                            sub: '#8e8e93'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        :root { --sat: env(safe-area-inset-top); --sab: env(safe-area-inset-bottom); }
        body { -webkit-tap-highlight-color: transparent; user-select: none; -webkit-touch-callout: none; touch-action: pan-y; }
        input { font-size: 16px !important; }
        button { touch-action: manipulation; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tabular-nums { font-variant-numeric: tabular-nums; }
        
        .effect-press:active { transform: scale(0.92); transition: transform 0.1s; }
        .effect-key-active:active { filter: brightness(1.2); }
        
        .anim-list-move, .anim-list-enter-active, .anim-list-leave-active { transition: all 0.3s ease; }
        .anim-list-enter-from, .anim-list-leave-to { opacity: 0; transform: translateY(10px); }
        .anim-list-leave-active { position: absolute; width: 100%; }
        
        .modal-backdrop { backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }

        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body :class="{'dark': isDarkMode}" class="bg-gray-50 text-gray-900 h-[100dvh] w-screen overflow-hidden flex justify-center transition-colors duration-300">

    <div id="app" class="w-full max-w-md h-full shadow-2xl flex flex-col relative overflow-hidden transition-colors duration-300 bg-white dark:bg-dark-bg dark:text-dark-text">
        
        <!-- Toast Notification -->
        <transition name="anim-list">
            <div v-if="showToast" id="toast-notification" class="absolute top-24 left-1/2 -translate-x-1/2 bg-gray-900/90 dark:bg-white/90 backdrop-blur text-white dark:text-gray-900 px-4 py-2 rounded-full text-sm shadow-xl z-50 flex items-center gap-2 pointer-events-none">
                <i class="fa-solid fa-check text-emerald-400 dark:text-emerald-600"></i> {{ toastMessage }}
            </div>
        </transition>

        <!-- Header -->
        <header id="app-header" class="flex justify-between items-center px-5 py-3 shrink-0 pt-[max(1rem,env(safe-area-inset-top))] z-20">
            <button id="btn-info" @click="openInfo" class="w-10 h-10 rounded-full flex items-center justify-center text-gray-400 hover:text-emerald-500 dark:text-gray-500 transition effect-press">
                <i class="fa-solid fa-circle-info text-xl"></i>
            </button>
            <div class="flex flex-col items-center opacity-80">
                <h1 class="font-bold text-gray-800 dark:text-white tracking-widest text-sm select-none uppercase">WAYFARER</h1>
            </div>
            <button id="btn-history" @click="openHistory" class="w-10 h-10 rounded-full flex items-center justify-center text-gray-400 hover:text-emerald-500 dark:text-gray-500 transition effect-press relative">
                <i class="fa-solid fa-clock-rotate-left text-xl"></i>
                <span v-if="hasHistory" class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-dark-bg"></span>
            </button>
        </header>

        <!-- Master Display -->
        <section id="source-display-area" class="px-4 pb-2 shrink-0 z-10">
            <div class="bg-white dark:bg-dark-card rounded-[1.5rem] p-4 shadow-sm border border-gray-100 dark:border-gray-800 relative overflow-hidden transition-all duration-300">
                <button id="btn-undo" @click.stop="undo" v-if="canUndo" class="absolute top-4 right-4 text-gray-300 hover:text-emerald-500 dark:text-gray-600 dark:hover:text-emerald-400 transition p-2 z-20">
                    <i class="fa-solid fa-rotate-left"></i>
                </button>
                
                <div @click="openSourceSelector" class="flex items-center gap-3 mb-2 cursor-pointer p-1 -ml-1 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors w-fit effect-press">
                    <span class="text-3xl shadow-sm rounded-full overflow-hidden">{{ sourceFlag }}</span>
                    <div class="flex flex-col">
                        <span class="font-bold text-xl leading-none dark:text-white flex items-center gap-1">
                            {{ sourceCurrency }}
                            <i class="fa-solid fa-caret-down text-[10px] text-gray-300 dark:text-gray-600"></i>
                        </span>
                        <span class="text-[10px] text-gray-400 dark:text-gray-500 font-medium mt-0.5">{{ sourceName }}</span>
                    </div>
                </div>

                <div @click="copyResult" class="text-right flex flex-col justify-end min-h-[70px] cursor-pointer group relative active:opacity-60 transition-opacity">
                    <div class="absolute top-0 right-0 text-[10px] text-gray-300 dark:text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">é»æ“Šè¤‡è£½</div>
                    <div id="formula-display" class="text-emerald-600 dark:text-emerald-400 font-mono text-sm tracking-wide break-all opacity-80 mb-1 leading-tight min-h-[1.25em]">
                        {{ fullExpressionDisplay }}
                    </div>
                    <div id="result-display" class="font-normal tracking-tight text-gray-900 dark:text-white tabular-nums leading-none break-all transition-all" :class="realTimeResultDisplay.length > 9 ? 'text-4xl' : 'text-5xl'">
                        {{ realTimeResultDisplay }}
                    </div>
                </div>
            </div>
        </section>

        <!-- Target List -->
        <section id="target-list-area" class="flex-grow min-h-0 relative group">
            
            <transition name="fade">
                <button v-if="canScrollUp" @click="scrollList('up')" class="absolute top-2 left-1/2 -translate-x-1/2 z-20 w-8 h-8 rounded-full bg-white/90 dark:bg-dark-card/90 shadow-md border border-gray-100 dark:border-gray-700 flex items-center justify-center text-emerald-500 hover:scale-110 transition-transform cursor-pointer backdrop-blur">
                    <i class="fa-solid fa-chevron-up text-sm"></i>
                </button>
            </transition>

            <div ref="listContainer" @scroll="handleListScroll" class="h-full overflow-y-auto px-4 py-2 space-y-2 no-scrollbar scroll-smooth">
                <div class="flex items-center justify-between px-2 mb-1 opacity-50 relative z-0">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 dark:text-gray-600">Rates</span>
                    <button id="btn-add-currency" @click="openAddSelector" class="text-xs text-emerald-600 dark:text-emerald-500 font-medium flex items-center gap-1 effect-press">
                        <i class="fa-solid fa-circle-plus"></i> æ–°å¢
                    </button>
                </div>
                <transition-group name="anim-list">
                    <div v-for="(item, index) in targetListDisplay" :key="item.code" class="sem-currency-row group/row flex items-center justify-between p-3 rounded-xl hover:bg-white dark:hover:bg-dark-card border border-transparent hover:border-gray-100 dark:hover:border-gray-800 transition-all duration-200 cursor-pointer relative z-0" @click="swapToSource(index)">
                        <div class="flex items-center gap-3">
                            <span class="text-xl rounded-full opacity-90 group-hover:opacity-100 transition-opacity">{{ item.flag }}</span>
                            <div class="flex flex-col">
                                <div class="flex items-baseline gap-2">
                                    <span class="font-bold text-gray-700 dark:text-gray-200 text-sm">{{ item.code }}</span>
                                    <span class="text-[10px] text-gray-400 dark:text-gray-600">1 {{ sourceCurrency }} = {{ item.rateDisplay }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-right">
                                <div class="text-lg font-medium text-gray-800 dark:text-gray-100 tabular-nums tracking-tight">{{ item.valueDisplay }}</div>
                            </div>
                            <button 
                                @click.stop="triggerDelete(index)" 
                                class="sem-btn-delete h-8 rounded-full flex items-center justify-center transition-all duration-200 ease-out"
                                :class="deleteConfirmIndex === index 
                                    ? 'w-12 bg-red-500 text-white shadow-md' 
                                    : 'w-8 bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20'"
                            >
                                <span v-if="deleteConfirmIndex === index" class="text-xs font-bold whitespace-nowrap">åˆªé™¤</span>
                                <i v-else class="fa-solid fa-minus text-[10px]"></i>
                            </button>
                        </div>
                    </div>
                </transition-group>
                <div class="h-4"></div>
            </div>

            <transition name="fade">
                <button v-if="canScrollDown" @click="scrollList('down')" class="absolute bottom-2 left-1/2 -translate-x-1/2 z-20 w-8 h-8 rounded-full bg-white/90 dark:bg-dark-card/90 shadow-md border border-gray-100 dark:border-gray-700 flex items-center justify-center text-emerald-500 hover:scale-110 transition-transform cursor-pointer backdrop-blur">
                    <i class="fa-solid fa-chevron-down text-sm"></i>
                </button>
            </transition>
        </section>

        <!-- Keypad -->
        <section id="keypad-area" class="grid grid-cols-4 gap-[1px] bg-gray-200 dark:bg-black shrink-0 p-[1px] pb-[env(safe-area-inset-bottom)] select-none z-30 shadow-[0_-4px_10px_rgba(0,0,0,0.03)]">
            <button @click="handleAC" class="sem-key-func bg-gray-100 dark:bg-dark-btn text-red-500 font-medium text-lg h-[56px] effect-key-active transition-all duration-200">{{ isAC ? 'AC' : 'C' }}</button>
            <button @click="backspace" class="sem-key-func bg-gray-100 dark:bg-dark-btn text-gray-600 dark:text-gray-300 font-medium text-xl effect-key-active"><i class="fa-solid fa-delete-left"></i></button>
            <button @click="applyPercentage" class="sem-key-func bg-gray-100 dark:bg-dark-btn text-emerald-600 dark:text-emerald-400 font-medium text-lg effect-key-active">%</button>
            <button @click="appendOperator('/')" class="sem-key-op bg-emerald-500 dark:bg-emerald-600 text-white text-xl effect-key-active">Ã·</button>

            <button @click="appendNumber('7')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light h-[56px] effect-key-active">7</button>
            <button @click="appendNumber('8')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">8</button>
            <button @click="appendNumber('9')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">9</button>
            <button @click="appendOperator('*')" class="sem-key-op bg-emerald-500 dark:bg-emerald-600 text-white text-xl effect-key-active">Ã—</button>

            <button @click="appendNumber('4')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light h-[56px] effect-key-active">4</button>
            <button @click="appendNumber('5')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">5</button>
            <button @click="appendNumber('6')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">6</button>
            <button @click="appendOperator('-')" class="sem-key-op bg-emerald-500 dark:bg-emerald-600 text-white text-xl effect-key-active">-</button>

            <button @click="appendNumber('1')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light h-[56px] effect-key-active">1</button>
            <button @click="appendNumber('2')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">2</button>
            <button @click="appendNumber('3')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">3</button>
            <button @click="appendOperator('+')" class="sem-key-op bg-emerald-500 dark:bg-emerald-600 text-white text-xl effect-key-active">+</button>

            <button @click="appendNumber('0')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light h-[56px] effect-key-active">0</button>
            <button @click="appendNumber('00')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-xl font-light effect-key-active tracking-tight">00</button>
            <button @click="appendNumber('.')" class="sem-key-num bg-white dark:bg-dark-card text-gray-800 dark:text-white text-2xl font-light effect-key-active">.</button>
            <button @click="calculateFinal" class="sem-key-equal bg-emerald-600 dark:bg-emerald-500 text-white text-xl effect-key-active">=</button>
        </section>

        <!-- Modals -->
        <!-- Info Modal -->
        <transition enter-active-class="transition duration-300 ease-out" enter-from-class="opacity-0 scale-95" enter-to-class="opacity-100 scale-100" leave-active-class="transition duration-200 ease-in" leave-from-class="opacity-100 scale-100" leave-to-class="opacity-0 scale-95">
            <div v-if="isInfoOpen" id="modal-info" class="absolute inset-0 z-50 flex items-center justify-center p-6 modal-backdrop bg-black/20 dark:bg-black/50" @click.self="isInfoOpen = false">
                <div class="bg-white dark:bg-dark-card w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all border border-gray-100 dark:border-gray-800">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white">é—œæ–¼ Wayfarer Coinflow</h2>
                        <button @click="isInfoOpen = false" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-dark-btn flex items-center justify-center text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-2xl flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-800 flex items-center justify-center text-emerald-600 dark:text-emerald-400 shrink-0"><i class="fa-solid fa-rotate"></i></div>
                            <div><div class="text-xs text-emerald-600/70 dark:text-emerald-400/70 font-medium uppercase tracking-wide">Last Updated</div><div class="font-bold text-emerald-800 dark:text-emerald-300 text-lg">{{ lastUpdated }}</div></div>
                        </div>
                        <div class="flex items-center justify-between p-2">
                            <span class="text-gray-600 dark:text-gray-300 font-medium">æ·±è‰²æ¨¡å¼</span>
                            <button @click="toggleTheme" class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors duration-300 focus:outline-none" :class="isDarkMode ? 'bg-emerald-500' : 'bg-gray-200'"><span class="inline-block h-6 w-6 transform rounded-full bg-white shadow transition-transform duration-300" :class="isDarkMode ? 'translate-x-7' : 'translate-x-1'"><i v-if="isDarkMode" class="fa-solid fa-moon text-emerald-500 text-xs absolute top-1.5 left-1.5"></i><i v-else class="fa-solid fa-sun text-yellow-500 text-xs absolute top-1.5 left-1.5"></i></span></button>
                        </div>
                        <div class="text-xs text-gray-400 dark:text-dark-sub leading-relaxed border-t border-gray-100 dark:border-gray-800 pt-4">
                            <p class="mb-2"><strong class="text-gray-500 dark:text-gray-400">å…è²¬è²æ˜ï¼š</strong></p><p>æœ¬æ‡‰ç”¨ç¨‹å¼æä¾›ä¹‹åŒ¯ç‡è³‡æ–™åƒ…ä¾›åƒè€ƒã€‚å¯¦éš›äº¤æ˜“åŒ¯ç‡è«‹ä»¥æ‚¨çš„éŠ€è¡Œã€ä¿¡ç”¨å¡ç™¼å¡æ©Ÿæ§‹æˆ–äº¤æ˜“æ«ƒæª¯ç•¶ä¸‹å…¬å‘Šä¹‹è²·è³£åŒ¯ç‡ç‚ºæº–ã€‚</p>
                        </div>
                        <div class="text-center text-[10px] text-gray-300 dark:text-gray-700 font-mono">v1.2.0</div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Currency Selector Modal -->
        <transition enter-active-class="transition duration-300 ease-out" enter-from-class="translate-y-full" enter-to-class="translate-y-0" leave-active-class="transition duration-200 ease-in" leave-from-class="translate-y-0" leave-to-class="translate-y-full">
            <div v-if="isModalOpen" id="modal-selector" class="absolute inset-0 bg-white dark:bg-dark-bg z-50 flex flex-col pt-[env(safe-area-inset-top)]">
                <div class="px-4 py-4 border-b border-gray-100 dark:border-gray-800 flex items-center gap-3 shrink-0">
                    <button @click="isModalOpen = false" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 transition"><i class="fa-solid fa-xmark text-lg"></i></button>
                    <input ref="searchInput" v-model="searchQuery" type="text" placeholder="æœå°‹è²¨å¹£æˆ–åŠ å¯†è²¨å¹£..." class="w-full bg-gray-100 dark:bg-dark-card dark:text-white rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>

                <!-- åˆ‡æ›æŒ‰éˆ• -->
                <div class="flex gap-2 px-4 py-3 border-b border-gray-100 dark:border-gray-800">
                    <button @click="currencyFilter = 'all'" :class="currencyFilter === 'all' ? 'bg-emerald-500 text-white' : 'bg-gray-100 dark:bg-dark-card text-gray-600 dark:text-gray-400'" class="flex-1 py-2 rounded-lg font-medium transition">
                        å…¨éƒ¨
                    </button>
                    <button @click="currencyFilter = 'fiat'" :class="currencyFilter === 'fiat' ? 'bg-emerald-500 text-white' : 'bg-gray-100 dark:bg-dark-card text-gray-600 dark:text-gray-400'" class="flex-1 py-2 rounded-lg font-medium transition">
                        æ³•å¹£ ğŸ’±
                    </button>
                    <button @click="currencyFilter = 'crypto'" :class="currencyFilter === 'crypto' ? 'bg-emerald-500 text-white' : 'bg-gray-100 dark:bg-dark-card text-gray-600 dark:text-gray-400'" class="flex-1 py-2 rounded-lg font-medium transition">
                        åŠ å¯†è²¨å¹£ ğŸª™
                    </button>
                </div>

                <div class="flex-grow overflow-y-auto pb-20 p-2">
                    <button v-for="curr in filteredCurrencies" :key="curr.code" @click="selectCurrency(curr.code)" class="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-dark-card rounded-xl transition">
                        <div class="flex items-center gap-4">
                            <!-- æ³•å¹£é¡¯ç¤ºåœ‹æ——ï¼ŒåŠ å¯†è²¨å¹£é¡¯ç¤ºåœ–æ¨™ -->
                            <span class="text-3xl">{{ curr.flag || curr.icon }}</span>
                            <div class="flex flex-col items-start">
                                <span class="font-bold text-gray-800 dark:text-white text-lg">{{ curr.code }} - {{ curr.name }}</span>
                                <!-- åŠ å¯†è²¨å¹£é¡¯ç¤ºè‹±æ–‡åç¨± -->
                                <span v-if="curr.nameEn" class="text-xs text-gray-400 dark:text-gray-600">{{ curr.nameEn }}</span>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </transition>

        <!-- History Modal -->
        <transition enter-active-class="transition duration-300 ease-out" enter-from-class="translate-y-full" enter-to-class="translate-y-0" leave-active-class="transition duration-200 ease-in" leave-from-class="translate-y-0" leave-to-class="translate-y-full">
            <div v-if="isHistoryOpen" id="modal-history" class="absolute inset-0 bg-gray-50 dark:bg-dark-bg z-50 flex flex-col pt-[env(safe-area-inset-top)]">
                <div class="px-6 py-4 bg-white dark:bg-dark-card border-b border-gray-100 dark:border-gray-800 flex items-center justify-between shrink-0 shadow-sm">
                    <!-- äº¤æ›ä½ç½®ï¼šæ¸…é™¤ç§»åˆ°å·¦é‚Š -->
                    <button @click="handleClearHistory" class="text-red-500 text-sm font-medium">{{ confirmDelete ? 'ç¢ºèª' : 'æ¸…é™¤' }}</button>
                    
                    <h2 class="font-bold text-lg text-gray-800 dark:text-white">æ­·å²ç´€éŒ„</h2>
                    
                    <!-- äº¤æ›ä½ç½®ï¼šç¸®å°(é—œé–‰)ç§»åˆ°å³é‚Š -->
                    <button @click="isHistoryOpen = false"><i class="fa-solid fa-chevron-down text-lg text-gray-500"></i></button>
                </div>
                <div class="flex-grow overflow-y-auto p-4 space-y-3">
                    <div v-if="history.length === 0" class="flex flex-col items-center justify-center h-64 text-gray-400 gap-2"><p class="text-sm">ç„¡ç´€éŒ„</p></div>
                    <div v-for="(item, index) in history" :key="index" @click="useHistoryItem(item.result)" class="bg-white dark:bg-dark-card p-4 rounded-2xl shadow-sm cursor-pointer border border-transparent dark:border-gray-800">
                        <div class="text-gray-500 dark:text-gray-400 text-right text-sm font-mono">{{ item.formula }}</div>
                        <div class="text-emerald-600 dark:text-emerald-400 text-right text-2xl font-bold font-mono mt-1">= {{ item.resultFormatted }}</div>
                    </div>
                </div>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick, reactive } = Vue;

        // Constants
        const AppConfig = {
            STORAGE_KEY: 'wayfarer_prefs_v1',
            MAX_HISTORY_ITEMS: 20
        };

        const currencyMeta = {
            "AED": { name: "é˜¿è¯è¿ªæ‹‰å§†", flag: "ğŸ‡¦ğŸ‡ª", symbol: "Ø¯.Ø¥" },
            "AFN": { name: "é˜¿å¯Œæ±—å°¼", flag: "ğŸ‡¦ğŸ‡«", symbol: "Ø‹" },
            "ALL": { name: "é˜¿çˆ¾å·´å°¼äºåˆ—å…‹", flag: "ğŸ‡¦ğŸ‡±", symbol: "L" },
            "AMD": { name: "äºç¾å°¼äºå¾·æ‹‰å§†", flag: "ğŸ‡¦ğŸ‡²", symbol: "Ö" },
            "ANG": { name: "è·å±¬å®‰çš„åˆ—æ–¯ç›¾", flag: "ğŸ‡¨ğŸ‡¼", symbol: "Æ’" },
            "AOA": { name: "å®‰å“¥æ‹‰å¯¬æ‰", flag: "ğŸ‡¦ğŸ‡´", symbol: "Kz" },
            "ARS": { name: "é˜¿æ ¹å»·æŠ«ç´¢", flag: "ğŸ‡¦ğŸ‡·", symbol: "$" },
            "AUD": { name: "æ¾³å¹£", flag: "ğŸ‡¦ğŸ‡º", symbol: "$" },
            "AWG": { name: "é˜¿é­¯å·´å¼—ç¾…æ—", flag: "ğŸ‡¦ğŸ‡¼", symbol: "Æ’" },
            "AZN": { name: "äºå¡æ‹œç„¶é¦¬ç´ç‰¹", flag: "ğŸ‡¦ğŸ‡¿", symbol: "â‚¼" },
            "BAM": { name: "æ³¢å£«å°¼äºé¦¬å…‹", flag: "ğŸ‡§ğŸ‡¦", symbol: "KM" },
            "BBD": { name: "å·´è²å¤šå…ƒ", flag: "ğŸ‡§ğŸ‡§", symbol: "$" },
            "BDT": { name: "å­ŸåŠ æ‹‰å¡”å¡", flag: "ğŸ‡§ğŸ‡©", symbol: "à§³" },
            "BGN": { name: "ä¿åŠ åˆ©äºåˆ—å¼—", flag: "ğŸ‡§ğŸ‡¬", symbol: "Ğ»Ğ²" },
            "BHD": { name: "å·´æ—ç¬¬ç´çˆ¾", flag: "ğŸ‡§ğŸ‡­", symbol: ".Ø¯.Ø¨" },
            "BIF": { name: "è’²éš†åœ°æ³•éƒ", flag: "ğŸ‡§ğŸ‡®", symbol: "Fr" },
            "BMD": { name: "ç™¾æ…•é”å…ƒ", flag: "ğŸ‡§ğŸ‡²", symbol: "$" },
            "BND": { name: "æ±¶èŠå…ƒ", flag: "ğŸ‡§ğŸ‡³", symbol: "$" },
            "BOB": { name: "ç»åˆ©ç¶­äºè«¾", flag: "ğŸ‡§ğŸ‡´", symbol: "Bs." },
            "BRL": { name: "å·´è¥¿é›·äºçˆ¾", flag: "ğŸ‡§ğŸ‡·", symbol: "R$" },
            "BSD": { name: "å·´å“ˆé¦¬å…ƒ", flag: "ğŸ‡§ğŸ‡¸", symbol: "$" },
            "BTN": { name: "ä¸ä¸¹åŠªçˆ¾ç‰¹é­¯å§†", flag: "ğŸ‡§ğŸ‡¹", symbol: "Nu." },
            "BWP": { name: "æ³¢æœ­é‚£æ™®æ‹‰", flag: "ğŸ‡§ğŸ‡¼", symbol: "P" },
            "BYN": { name: "ç™½ä¿„ç¾…æ–¯ç›§å¸ƒ", flag: "ğŸ‡§ğŸ‡¾", symbol: "Br" },
            "BZD": { name: "è²é‡Œæ–¯å…ƒ", flag: "ğŸ‡§ğŸ‡¿", symbol: "$" },
            "CAD": { name: "åŠ å¹£", flag: "ğŸ‡¨ğŸ‡¦", symbol: "$" },
            "CDF": { name: "å‰›æœæ³•éƒ", flag: "ğŸ‡¨ğŸ‡©", symbol: "Fr" },
            "CHF": { name: "ç‘å£«æ³•éƒ", flag: "ğŸ‡¨ğŸ‡­", symbol: "Fr" },
            "CLF": { name: "æ™ºåˆ©ç™¼å±•å–®ä½", flag: "ğŸ‡¨ğŸ‡±", symbol: "UF" },
            "CLP": { name: "æ™ºåˆ©æŠ«ç´¢", flag: "ğŸ‡¨ğŸ‡±", symbol: "$" },
            "CNH": { name: "é›¢å²¸äººæ°‘å¹£", flag: "ğŸ‡¨ğŸ‡³", symbol: "Â¥" },
            "CNY": { name: "äººæ°‘å¹£", flag: "ğŸ‡¨ğŸ‡³", symbol: "Â¥" },
            "COP": { name: "å“¥å€«æ¯”äºæŠ«ç´¢", flag: "ğŸ‡¨ğŸ‡´", symbol: "$" },
            "CRC": { name: "å“¥æ–¯å¤§é»åŠ ç§‘æœ—", flag: "ğŸ‡¨ğŸ‡·", symbol: "â‚¡" },
            "CUP": { name: "å¤å·´æŠ«ç´¢", flag: "ğŸ‡¨ğŸ‡º", symbol: "$" },
            "CVE": { name: "ç¶­å¾·è§’åŸƒæ–¯åº«å¤š", flag: "ğŸ‡¨ğŸ‡»", symbol: "$" },
            "CZK": { name: "æ·å…‹å…‹æœ—", flag: "ğŸ‡¨ğŸ‡¿", symbol: "KÄ" },
            "DJF": { name: "å‰å¸ƒåœ°æ³•éƒ", flag: "ğŸ‡©ğŸ‡¯", symbol: "Fr" },
            "DKK": { name: "ä¸¹éº¥å…‹æœ—", flag: "ğŸ‡©ğŸ‡°", symbol: "kr" },
            "DOP": { name: "å¤šæ˜å°¼åŠ æŠ«ç´¢", flag: "ğŸ‡©ğŸ‡´", symbol: "RD$" },
            "DZD": { name: "é˜¿çˆ¾åŠåˆ©äºç¬¬ç´çˆ¾", flag: "ğŸ‡©ğŸ‡¿", symbol: "Ø¯.Ø¬" },
            "EGP": { name: "åŸƒåŠéŠ", flag: "ğŸ‡ªğŸ‡¬", symbol: "Â£" },
            "ERN": { name: "å„åˆ©å‚äºç´å…‹æ³•", flag: "ğŸ‡ªğŸ‡·", symbol: "Nfk" },
            "ETB": { name: "è¡£ç´¢æ¯”äºæ¯”çˆ¾", flag: "ğŸ‡ªğŸ‡¹", symbol: "Br" },
            "EUR": { name: "æ­å…ƒ", flag: "ğŸ‡ªğŸ‡º", symbol: "â‚¬" },
            "FJD": { name: "æ–æ¿Ÿå…ƒ", flag: "ğŸ‡«ğŸ‡¯", symbol: "$" },
            "FKP": { name: "ç¦å…‹è˜­ç¾¤å³¶éŠ", flag: "ğŸ‡«ğŸ‡°", symbol: "Â£" },
            "FOK": { name: "æ³•ç¾…ç¾¤å³¶å…‹æœ—", flag: "ğŸ‡«ğŸ‡´", symbol: "kr" },
            "GBP": { name: "è‹±éŠ", flag: "ğŸ‡¬ğŸ‡§", symbol: "Â£" },
            "GEL": { name: "å–¬æ²»äºæ‹‰é‡Œ", flag: "ğŸ‡¬ğŸ‡ª", symbol: "â‚¾" },
            "GGP": { name: "æ ¹è¥¿éŠ", flag: "ğŸ‡¬ğŸ‡¬", symbol: "Â£" },
            "GHS": { name: "è¿¦ç´å¡åœ°", flag: "ğŸ‡¬ğŸ‡­", symbol: "â‚µ" },
            "GIP": { name: "ç›´å¸ƒç¾…é™€éŠ", flag: "ğŸ‡¬ğŸ‡®", symbol: "Â£" },
            "GMD": { name: "ç”˜æ¯”äºé”æ‹‰è¥¿", flag: "ğŸ‡¬ğŸ‡²", symbol: "D" },
            "GNF": { name: "å¹¾å…§äºæ³•éƒ", flag: "ğŸ‡¬ğŸ‡³", symbol: "Fr" },
            "GTQ": { name: "ç“œåœ°é¦¬æ‹‰æ ¼æŸ¥çˆ¾", flag: "ğŸ‡¬ğŸ‡¹", symbol: "Q" },
            "GYD": { name: "è“‹äºé‚£å…ƒ", flag: "ğŸ‡¬ğŸ‡¾", symbol: "$" },
            "HKD": { name: "æ¸¯å¹£", flag: "ğŸ‡­ğŸ‡°", symbol: "$" },
            "HNL": { name: "å®éƒ½æ‹‰æ–¯å€«çš®æ‹‰", flag: "ğŸ‡­ğŸ‡³", symbol: "L" },
            "HRK": { name: "å…‹ç¾…åŸƒè¥¿äºåº«ç´", flag: "ğŸ‡­ğŸ‡·", symbol: "kn" },
            "HTG": { name: "æµ·åœ°å¤å¾·", flag: "ğŸ‡­ğŸ‡¹", symbol: "G" },
            "HUF": { name: "åŒˆç‰™åˆ©ç¦æ—", flag: "ğŸ‡­ğŸ‡º", symbol: "Ft" },
            "IDR": { name: "å°å°¼ç›¾", flag: "ğŸ‡®ğŸ‡©", symbol: "Rp" },
            "ILS": { name: "ä»¥è‰²åˆ—è¬å…‹çˆ¾", flag: "ğŸ‡®ğŸ‡±", symbol: "â‚ª" },
            "IMP": { name: "æ›¼å³¶éŠ", flag: "ğŸ‡®ğŸ‡²", symbol: "Â£" },
            "INR": { name: "å°åº¦ç›§æ¯”", flag: "ğŸ‡®ğŸ‡³", symbol: "â‚¹" },
            "IQD": { name: "ä¼Šæ‹‰å…‹ç¬¬ç´çˆ¾", flag: "ğŸ‡®ğŸ‡¶", symbol: "Ø¹.Ø¯" },
            "IRR": { name: "ä¼Šæœ—é‡Œäºçˆ¾", flag: "ğŸ‡®ğŸ‡·", symbol: "ï·¼" },
            "ISK": { name: "å†°å³¶å…‹æœ—", flag: "ğŸ‡®ğŸ‡¸", symbol: "kr" },
            "JEP": { name: "æ¾¤è¥¿éŠ", flag: "ğŸ‡¯ğŸ‡ª", symbol: "Â£" },
            "JMD": { name: "ç‰™è²·åŠ å…ƒ", flag: "ğŸ‡¯ğŸ‡²", symbol: "$" },
            "JOD": { name: "ç´„æ—¦ç¬¬ç´çˆ¾", flag: "ğŸ‡¯ğŸ‡´", symbol: "Ø¯.Ø§" },
            "JPY": { name: "æ—¥åœ“", flag: "ğŸ‡¯ğŸ‡µ", symbol: "Â¥" },
            "KES": { name: "è‚¯äºå…ˆä»¤", flag: "ğŸ‡°ğŸ‡ª", symbol: "Sh" },
            "KGS": { name: "å‰çˆ¾å‰æ–¯ç´¢å§†", flag: "ğŸ‡°ğŸ‡¬", symbol: "Ñ" },
            "KHR": { name: "æŸ¬åŸ”å¯¨ç‘çˆ¾", flag: "ğŸ‡°ğŸ‡­", symbol: "áŸ›" },
            "KID": { name: "å‰é‡Œå·´æ–¯å…ƒ", flag: "ğŸ‡°ğŸ‡®", symbol: "$" },
            "KMF": { name: "è‘›æ‘©æ³•éƒ", flag: "ğŸ‡°ğŸ‡²", symbol: "Fr" },
            "KRW": { name: "éŸ“å…ƒ", flag: "ğŸ‡°ğŸ‡·", symbol: "â‚©" },
            "KWD": { name: "ç§‘å¨ç‰¹ç¬¬ç´çˆ¾", flag: "ğŸ‡°ğŸ‡¼", symbol: "Ø¯.Ùƒ" },
            "KYD": { name: "é–‹æ›¼ç¾¤å³¶å…ƒ", flag: "ğŸ‡°ğŸ‡¾", symbol: "$" },
            "KZT": { name: "å“ˆè–©å…‹å …æˆˆ", flag: "ğŸ‡°ğŸ‡¿", symbol: "â‚¸" },
            "LAK": { name: "å¯®åœ‹åŸºæ™®", flag: "ğŸ‡±ğŸ‡¦", symbol: "â‚­" },
            "LBP": { name: "é»å·´å«©éŠ", flag: "ğŸ‡±ğŸ‡§", symbol: "Ù„.Ù„" },
            "LKR": { name: "æ–¯é‡Œè˜­å¡ç›§æ¯”", flag: "ğŸ‡±ğŸ‡°", symbol: "Rs" },
            "LRD": { name: "è³´æ¯”ç‘äºå…ƒ", flag: "ğŸ‡±ğŸ‡·", symbol: "$" },
            "LSL": { name: "è³´ç´¢æ‰˜æ´›è’‚", flag: "ğŸ‡±ğŸ‡¸", symbol: "L" },
            "LYD": { name: "åˆ©æ¯”äºç¬¬ç´çˆ¾", flag: "ğŸ‡±ğŸ‡¾", symbol: "Ù„.Ø¯" },
            "MAD": { name: "æ‘©æ´›å“¥è¿ªæ‹‰å§†", flag: "ğŸ‡²ğŸ‡¦", symbol: "dh" },
            "MDL": { name: "æ‘©çˆ¾å¤šç“¦åˆ—ä¼Š", flag: "ğŸ‡²ğŸ‡©", symbol: "L" },
            "MGA": { name: "é¦¬é”åŠ æ–¯åŠ é˜¿é‡Œäºé‡Œ", flag: "ğŸ‡²ğŸ‡¬", symbol: "Ar" },
            "MKD": { name: "é¦¬å…¶é “ä»£ç´çˆ¾", flag: "ğŸ‡²ğŸ‡°", symbol: "Ğ´ĞµĞ½" },
            "MMK": { name: "ç·¬ç”¸å…ƒ", flag: "ğŸ‡²ğŸ‡²", symbol: "K" },
            "MNT": { name: "è’™å¤åœ–æ ¼é‡Œå…‹", flag: "ğŸ‡²ğŸ‡³", symbol: "â‚®" },
            "MOP": { name: "æ¾³é–€å¹£", flag: "ğŸ‡²ğŸ‡´", symbol: "P" },
            "MRU": { name: "èŒ…åˆ©å¡”å°¼äºçƒå‰äº", flag: "ğŸ‡²ğŸ‡·", symbol: "UM" },
            "MUR": { name: "æ¨¡é‡Œè¥¿æ–¯ç›§æ¯”", flag: "ğŸ‡²ğŸ‡º", symbol: "â‚¨" },
            "MVR": { name: "é¦¬çˆ¾åœ°å¤«æ‹‰è²äº", flag: "ğŸ‡²ğŸ‡»", symbol: "Rf" },
            "MWK": { name: "é¦¬æ‹‰å¨å…‹ç“¦æŸ¥", flag: "ğŸ‡²ğŸ‡¼", symbol: "MK" },
            "MXN": { name: "å¢¨è¥¿å“¥æŠ«ç´¢", flag: "ğŸ‡²ğŸ‡½", symbol: "$" },
            "MYR": { name: "é¦¬ä¾†å¹£", flag: "ğŸ‡²ğŸ‡¾", symbol: "RM" },
            "MZN": { name: "è«ä¸‰æ¯”å…‹æ¢…è’‚å¡çˆ¾", flag: "ğŸ‡²ğŸ‡¿", symbol: "MT" },
            "NAD": { name: "ç´ç±³æ¯”äºå…ƒ", flag: "ğŸ‡³ğŸ‡¦", symbol: "$" },
            "NGN": { name: "å¥ˆåŠåˆ©äºå¥ˆæ‹‰", flag: "ğŸ‡³ğŸ‡¬", symbol: "â‚¦" },
            "NIO": { name: "å°¼åŠ æ‹‰ç“œå“¥å¤šè¯", flag: "ğŸ‡³ğŸ‡®", symbol: "C$" },
            "NOK": { name: "æŒªå¨å…‹æœ—", flag: "ğŸ‡³ğŸ‡´", symbol: "kr" },
            "NPR": { name: "å°¼æ³Šçˆ¾ç›§æ¯”", flag: "ğŸ‡³ğŸ‡µ", symbol: "â‚¨" },
            "NZD": { name: "ç´å¹£", flag: "ğŸ‡³ğŸ‡¿", symbol: "$" },
            "OMR": { name: "é˜¿æ›¼é‡Œäºçˆ¾", flag: "ğŸ‡´ğŸ‡²", symbol: "Ø±.Ø¹." },
            "PAB": { name: "å·´æ‹¿é¦¬å·´æ³¢äº", flag: "ğŸ‡µğŸ‡¦", symbol: "B/." },
            "PEN": { name: "ç§˜é­¯ç´¢çˆ¾", flag: "ğŸ‡µğŸ‡ª", symbol: "S/" },
            "PGK": { name: "å·´å¸ƒäºç´å¹¾å…§äºåŸºé‚£", flag: "ğŸ‡µğŸ‡¬", symbol: "K" },
            "PHP": { name: "è²å¾‹è³“æŠ«ç´¢", flag: "ğŸ‡µğŸ‡­", symbol: "â‚±" },
            "PKR": { name: "å·´åŸºæ–¯å¦ç›§æ¯”", flag: "ğŸ‡µğŸ‡°", symbol: "â‚¨" },
            "PLN": { name: "æ³¢è˜­èŒ²ç¾…æ", flag: "ğŸ‡µğŸ‡±", symbol: "zÅ‚" },
            "PYG": { name: "å·´æ‹‰åœ­ç“œæ‹‰å°¼", flag: "ğŸ‡µğŸ‡¾", symbol: "â‚²" },
            "QAR": { name: "å¡é”é‡Œäºçˆ¾", flag: "ğŸ‡¶ğŸ‡¦", symbol: "Ø±.Ù‚" },
            "RON": { name: "ç¾…é¦¬å°¼äºåˆ—ä¼Š", flag: "ğŸ‡·ğŸ‡´", symbol: "lei" },
            "RSD": { name: "å¡çˆ¾ç¶­äºç¬¬ç´çˆ¾", flag: "ğŸ‡·ğŸ‡¸", symbol: "Ğ´Ğ¸Ğ½." },
            "RUB": { name: "ä¿„ç¾…æ–¯ç›§å¸ƒ", flag: "ğŸ‡·ğŸ‡º", symbol: "â‚½" },
            "RWF": { name: "ç›§å®‰é”æ³•éƒ", flag: "ğŸ‡·ğŸ‡¼", symbol: "Fr" },
            "SAR": { name: "æ²™çƒåœ°é‡Œäºçˆ¾", flag: "ğŸ‡¸ğŸ‡¦", symbol: "Ø±.Ø³" },
            "SBD": { name: "ç´¢ç¾…é–€ç¾¤å³¶å…ƒ", flag: "ğŸ‡¸ğŸ‡§", symbol: "$" },
            "SCR": { name: "å¡å¸­çˆ¾ç›§æ¯”", flag: "ğŸ‡¸ğŸ‡¨", symbol: "â‚¨" },
            "SDG": { name: "è˜‡ä¸¹éŠ", flag: "ğŸ‡¸ğŸ‡©", symbol: "Â£" },
            "SEK": { name: "ç‘å…¸å…‹æœ—", flag: "ğŸ‡¸ğŸ‡ª", symbol: "kr" },
            "SGD": { name: "æ–°å¹£", flag: "ğŸ‡¸ğŸ‡¬", symbol: "$" },
            "SHP": { name: "è–èµ«å‹’æ‹¿éŠ", flag: "ğŸ‡¸ğŸ‡­", symbol: "Â£" },
            "SLE": { name: "ç…å­å±±åˆ©æ˜‚", flag: "ğŸ‡¸ğŸ‡±", symbol: "Le" },
            "SLL": { name: "ç…å­å±±åˆ©æ˜‚", flag: "ğŸ‡¸ğŸ‡±", symbol: "Le" },
            "SOS": { name: "ç´¢é¦¬åˆ©äºå…ˆä»¤", flag: "ğŸ‡¸ğŸ‡´", symbol: "Sh" },
            "SRD": { name: "è˜‡åˆ©å—å…ƒ", flag: "ğŸ‡¸ğŸ‡·", symbol: "$" },
            "SSP": { name: "å—è˜‡ä¸¹éŠ", flag: "ğŸ‡¸ğŸ‡¸", symbol: "Â£" },
            "STN": { name: "è–å¤šç¾å¤šå¸ƒæ‹‰", flag: "ğŸ‡¸ğŸ‡¹", symbol: "Db" },
            "SYP": { name: "æ•˜åˆ©äºéŠ", flag: "ğŸ‡¸ğŸ‡¾", symbol: "Â£" },
            "SZL": { name: "å²ç“¦å¸å°¼é‡Œè˜­å‰å°¼", flag: "ğŸ‡¸ğŸ‡¿", symbol: "L" },
            "TJS": { name: "å¡”å‰å…‹ç´¢è«å°¼", flag: "ğŸ‡¹ğŸ‡¯", symbol: "Ğ…Ğœ" },
            "THB": { name: "æ³°éŠ–", flag: "ğŸ‡¹ğŸ‡­", symbol: "à¸¿" },
            "TMT": { name: "åœŸåº«æ›¼é¦¬ç´ç‰¹", flag: "ğŸ‡¹ğŸ‡²", symbol: "m" },
            "TND": { name: "çªå°¼è¥¿äºç¬¬ç´çˆ¾", flag: "ğŸ‡¹ğŸ‡³", symbol: "Ø¯.Øª" },
            "TOP": { name: "æ±åŠ æ½˜åŠ ", flag: "ğŸ‡¹ğŸ‡´", symbol: "T$" },
            "TRY": { name: "åœŸè€³å…¶é‡Œæ‹‰", flag: "ğŸ‡¹ğŸ‡·", symbol: "â‚º" },
            "TTD": { name: "åƒé‡Œé”åŠæ‰˜å·´å“¥å…ƒ", flag: "ğŸ‡¹ğŸ‡¹", symbol: "$" },
            "TVD": { name: "åç“¦é­¯å…ƒ", flag: "ğŸ‡¹ğŸ‡»", symbol: "$" },
            "TWD": { name: "æ–°å°å¹£", flag: "ğŸ‡¹ğŸ‡¼", symbol: "$" },
            "TZS": { name: "å¦å°šå°¼äºå…ˆä»¤", flag: "ğŸ‡¹ğŸ‡¿", symbol: "Sh" },
            "UAH": { name: "çƒå…‹è˜­æ ¼é‡Œå¤«ç´", flag: "ğŸ‡ºğŸ‡¦", symbol: "â‚´" },
            "UGX": { name: "çƒå¹²é”å…ˆä»¤", flag: "ğŸ‡ºğŸ‡¬", symbol: "Sh" },
            "USD": { name: "ç¾å…ƒ", flag: "ğŸ‡ºğŸ‡¸", symbol: "$" },
            "UYU": { name: "çƒæ‹‰åœ­æŠ«ç´¢", flag: "ğŸ‡ºğŸ‡¾", symbol: "$" },
            "UZS": { name: "çƒèŒ²åˆ¥å…‹ç´¢å§†", flag: "ğŸ‡ºğŸ‡¿", symbol: "so'm" },
            "VES": { name: "å§”å…§ç‘æ‹‰ç»åˆ©ç“¦", flag: "ğŸ‡»ğŸ‡ª", symbol: "Bs." },
            "VND": { name: "è¶Šå—ç›¾", flag: "ğŸ‡»ğŸ‡³", symbol: "â‚«" },
            "VUV": { name: "è¬é‚£æœç“¦åœ–", flag: "ğŸ‡»ğŸ‡º", symbol: "Vt" },
            "WST": { name: "è–©æ‘©äºå¡”æ‹‰", flag: "ğŸ‡¼ğŸ‡¸", symbol: "T" },
            "XAF": { name: "ä¸­éæ³•éƒ", flag: "ğŸ‡¨ğŸ‡²", symbol: "Fr" },
            "XCD": { name: "æ±åŠ å‹’æ¯”å…ƒ", flag: "ğŸ‡¦ğŸ‡¬", symbol: "$" },
            "XCG": { name: "åŠ å‹’æ¯”ç›¾", flag: "ğŸ‡¨ğŸ‡¼", symbol: "Æ’" },
            "XDR": { name: "ç‰¹åˆ¥ææ¬¾æ¬Š", flag: "ğŸŒ", symbol: "SDR" },
            "XOF": { name: "è¥¿éæ³•éƒ", flag: "ğŸ‡¸ğŸ‡³", symbol: "Fr" },
            "XPF": { name: "å¤ªå¹³æ´‹æ³•éƒ", flag: "ğŸ‡µğŸ‡«", symbol: "Fr" },
            "YER": { name: "è‘‰é–€é‡Œäºçˆ¾", flag: "ğŸ‡¾ğŸ‡ª", symbol: "ï·¼" },
            "ZAR": { name: "å—éè˜­ç‰¹", flag: "ğŸ‡¿ğŸ‡¦", symbol: "R" },
            "ZMW": { name: "å°šæ¯”äºå…‹ç“¦æŸ¥", flag: "ğŸ‡¿ğŸ‡²", symbol: "ZK" },
            "ZWG": { name: "è¾›å·´å¨é‡‘", flag: "ğŸ‡¿ğŸ‡¼", symbol: "ZiG" },
            "ZWL": { name: "è¾›å·´å¨å…ƒ", flag: "ğŸ‡¿ğŸ‡¼", symbol: "$" }
        };

        createApp({
            setup() {
                // Constants
                const CACHE_KEY = 'wayfarer_rates_cache_v1';

                // State
                const rates = ref({});
                const lastUpdated = ref('Updating...');
                const isLoading = ref(true);
                const showToast = ref(false);
                const toastMessage = ref('');
                const isDarkMode = ref(false);
                
                // èª¿æ•´é è¨­å€¼ï¼šä¸»è²¨å¹£ç‚º JPY (æ—¥åœ“)
                const sourceCurrency = ref('JPY');
                // èª¿æ•´é è¨­æ¸…å–®ï¼šTWD (å°å¹£) æ”¾ç¬¬ä¸€ä½ï¼Œæ¥è‘— USD, KRW
                const targetCurrencies = ref(['TWD', 'USD', 'KRW']);
                
                const inputDisplay = ref('');
                const expressionAccumulator = ref('');
                const shouldResetScreen = ref(false);
                const undoStack = ref([]);
                
                const isModalOpen = ref(false);
                const isInfoOpen = ref(false);
                const isHistoryOpen = ref(false);
                const modalMode = ref('source');
                const searchQuery = ref('');
                const currencyFilter = ref('all');  // 'all', 'fiat', 'crypto'
                const searchInput = ref(null);
                const history = ref([]);
                const confirmDelete = ref(false);

                // Scroll Logic Variables
                const listContainer = ref(null);
                const canScrollUp = ref(false);
                const canScrollDown = ref(false);

                // Delete Confirmation Logic
                const deleteConfirmIndex = ref(null);
                let deleteResetTimer = null;

                const triggerDelete = (index) => {
                    if (deleteConfirmIndex.value === index) {
                        removeTarget(index);
                        deleteConfirmIndex.value = null;
                        if (deleteResetTimer) clearTimeout(deleteResetTimer);
                    } else {
                        deleteConfirmIndex.value = index;
                        if (deleteResetTimer) clearTimeout(deleteResetTimer);
                        deleteResetTimer = setTimeout(() => {
                            deleteConfirmIndex.value = null;
                        }, 3000);
                    }
                };

                // --- Methods ---

                const fetchRates = async () => {
                    isLoading.value = true;
                    try {
                        const res = await fetch('./rates.json');
                        if(!res.ok) throw new Error("Failed to fetch");
                        
                        const data = await res.json();
                        
                        const newRates = {};
                        
                        if (data.base) {
                            const baseMeta = currencyMeta[data.base] || { name: data.base, flag: 'ğŸŒ', symbol: '$' };
                            newRates[data.base] = { rate: 1, ...baseMeta };
                        }

                        for (const [code, rate] of Object.entries(data.rates)) {
                            const meta = currencyMeta[code] || { name: code, flag: 'ğŸŒ', symbol: '$' };
                            newRates[code] = { rate, ...meta };
                        }
                        
                        rates.value = newRates;
                        lastUpdated.value = data.date || new Date().toLocaleDateString();

                        // âœ… æ–°å¢ï¼šå„²å­˜åˆ° localStorage
                        try {
                            localStorage.setItem(CACHE_KEY, JSON.stringify({
                                rates: newRates,
                                date: data.date || new Date().toLocaleDateString(),
                                timestamp: Date.now()
                            }));
                            console.log('åŒ¯ç‡å·²å¿«å–åˆ° localStorage');
                        } catch (err) {
                            console.warn('ç„¡æ³•å„²å­˜å¿«å–', err);
                        }

                    } catch (e) {
                        console.warn("Fetch failed, trying fallbacks", e);

                        // 1. å˜—è©¦ localStorage å¿«å–
                        const cached = localStorage.getItem(CACHE_KEY);
                        if (cached) {
                            try {
                                const cachedData = JSON.parse(cached);
                                const age = Date.now() - (cachedData.timestamp || 0);

                                // å¿«å–å°æ–¼ 7 å¤©æ‰ä½¿ç”¨
                                if (age < 7 * 24 * 60 * 60 * 1000) {
                                    rates.value = cachedData.rates;
                                    lastUpdated.value = `${cachedData.date} (å¿«å–)`;
                                    const daysAgo = Math.floor(age / (24 * 60 * 60 * 1000));
                                    console.log(`ä½¿ç”¨å¿«å–è³‡æ–™ï¼Œ${daysAgo} å¤©å‰`);
                                    return;
                                }
                            } catch (err) {
                                console.warn("å¿«å–è³‡æ–™ç„¡æ•ˆ", err);
                            }
                        }

                        // 2. ä½¿ç”¨å®‰å…¨å‚™æ´ï¼ˆåƒ…ä¸»è¦è²¨å¹£çš„åˆç†åŒ¯ç‡ï¼‰
                        const safeFallback = {
                            'USD': { rate: 1.0, ...currencyMeta['USD'] },
                            'EUR': { rate: 0.85, ...currencyMeta['EUR'] },
                            'GBP': { rate: 0.75, ...currencyMeta['GBP'] },
                            'JPY': { rate: 150.0, ...currencyMeta['JPY'] },
                            'CNY': { rate: 7.0, ...currencyMeta['CNY'] },
                            'TWD': { rate: 32.0, ...currencyMeta['TWD'] },
                            'HKD': { rate: 7.8, ...currencyMeta['HKD'] },
                            'KRW': { rate: 1300.0, ...currencyMeta['KRW'] },
                            'THB': { rate: 35.5, ...currencyMeta['THB'] },
                            'SGD': { rate: 1.3, ...currencyMeta['SGD'] },
                            'AUD': { rate: 1.5, ...currencyMeta['AUD'] },
                            'CAD': { rate: 1.35, ...currencyMeta['CAD'] },
                            'CHF': { rate: 0.9, ...currencyMeta['CHF'] }
                        };

                        rates.value = safeFallback;
                        lastUpdated.value = "é›¢ç·šæ¨¡å¼ - æœ‰é™è²¨å¹£";
                    } finally {
                        isLoading.value = false;
                        loadPrefs();
                        nextTick(checkScroll); // Check scroll after load
                    }
                };

                // åŠ å¯†è²¨å¹£åŒ¯ç‡è¼‰å…¥
                const cryptoRates = ref({});

                const fetchCryptoRates = async () => {
                    try {
                        const res = await fetch('./crypto-rates.json');
                        if (!res.ok) throw new Error("Failed to fetch crypto");

                        const data = await res.json();

                        // è¼‰å…¥åŠ å¯†è²¨å¹£å…ƒæ•¸æ“š
                        let cryptoMeta = {};
                        try {
                            const metaRes = await fetch('./crypto-currencies.json');
                            if (metaRes.ok) {
                                cryptoMeta = await metaRes.json();
                            }
                        } catch (e) {
                            console.warn("Crypto metadata not found");
                        }

                        const newCryptoRates = {};

                        for (const [code, rate] of Object.entries(data.rates)) {
                            const meta = cryptoMeta[code] || {
                                name: code,
                                icon: 'ğŸª™',
                                symbol: code
                            };

                            newCryptoRates[code] = {
                                rate,
                                ...meta,
                                type: 'crypto'  // æ¨™è¨˜ç‚ºåŠ å¯†è²¨å¹£
                            };
                        }

                        cryptoRates.value = newCryptoRates;

                        // åˆä½µåˆ°ä¸» rates ç‰©ä»¶ï¼ˆç”¨æ–¼çµ±ä¸€åŒ¯ç‡è¨ˆç®—ï¼‰
                        rates.value = { ...rates.value, ...newCryptoRates };

                        // å¿«å–åŠ å¯†è²¨å¹£æ•¸æ“š
                        try {
                            localStorage.setItem('wayfarer_crypto_cache_v1', JSON.stringify({
                                rates: newCryptoRates,
                                timestamp: Date.now()
                            }));
                        } catch (err) {
                            console.warn('ç„¡æ³•å„²å­˜åŠ å¯†è²¨å¹£å¿«å–', err);
                        }

                    } catch (e) {
                        console.warn("Crypto fetch failed, trying cache", e);

                        // å˜—è©¦å¿«å–ï¼ˆ24 å°æ™‚æœ‰æ•ˆï¼‰
                        const cached = localStorage.getItem('wayfarer_crypto_cache_v1');
                        if (cached) {
                            try {
                                const cachedData = JSON.parse(cached);
                                const age = Date.now() - (cachedData.timestamp || 0);

                                if (age < 24 * 60 * 60 * 1000) {
                                    cryptoRates.value = cachedData.rates;
                                    rates.value = { ...rates.value, ...cachedData.rates };
                                    console.log('ä½¿ç”¨åŠ å¯†è²¨å¹£å¿«å–');
                                    return;
                                }
                            } catch (err) {
                                console.warn("å¿«å–è³‡æ–™ç„¡æ•ˆ", err);
                            }
                        }

                        // å‚™æ´æ•¸æ“šï¼ˆä¸»è¦åŠ å¯†è²¨å¹£çš„åˆç†åƒ¹æ ¼ï¼‰
                        const cryptoFallback = {
                            'BTC': { rate: 88000, name: 'æ¯”ç‰¹å¹£', icon: 'â‚¿', symbol: 'BTC', type: 'crypto' },
                            'ETH': { rate: 2975, name: 'ä»¥å¤ªåŠ', icon: 'Î', symbol: 'ETH', type: 'crypto' },
                            'USDT': { rate: 1.0, name: 'æ³°é”å¹£', icon: 'â‚®', symbol: 'USDT', type: 'crypto' }
                        };

                        cryptoRates.value = cryptoFallback;
                        rates.value = { ...rates.value, ...cryptoFallback };
                    }
                };

                const savePrefs = () => {
                    const prefs = {
                        source: sourceCurrency.value,
                        targets: targetCurrencies.value,
                        darkMode: isDarkMode.value,
                        history: history.value
                    };
                    localStorage.setItem(AppConfig.STORAGE_KEY, JSON.stringify(prefs));
                };

                const loadPrefs = () => {
                    const saved = localStorage.getItem(AppConfig.STORAGE_KEY);
                    if (!saved) return;
                    try {
                        const prefs = JSON.parse(saved);
                        if (prefs.source && rates.value[prefs.source]) sourceCurrency.value = prefs.source;
                        if (Array.isArray(prefs.targets)) {
                            const valid = prefs.targets.filter(c => rates.value[c]);
                            if (valid.length > 0) targetCurrencies.value = valid;
                        }
                        if (typeof prefs.darkMode === 'boolean') {
                            isDarkMode.value = prefs.darkMode;
                            updateThemeClass();
                        }
                        if (Array.isArray(prefs.history)) history.value = prefs.history;
                    } catch (e) { console.error("Prefs load error", e); }
                };

                watch([sourceCurrency, targetCurrencies, isDarkMode, history], savePrefs, { deep: true });

                const toggleTheme = () => { isDarkMode.value = !isDarkMode.value; updateThemeClass(); };
                const updateThemeClass = () => { if(isDarkMode.value) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); };
                const getFlag = (code) => rates.value[code]?.flag || 'ğŸŒ';
                const getRate = (code) => rates.value[code]?.rate || 1;
                const canUndo = computed(() => undoStack.value.length > 0);
                const currencyList = computed(() => Object.keys(rates.value).sort());
                const sourceFlag = computed(() => getFlag(sourceCurrency.value));
                const sourceName = computed(() => rates.value[sourceCurrency.value]?.name);
                const hasHistory = computed(() => history.value.length > 0);
                
                const filteredCurrencies = computed(() => {
                    const q = searchQuery.value.toLowerCase();
                    let list = currencyList.value;

                    // æ ¹æ“šç¯©é¸å™¨éæ¿¾
                    if (currencyFilter.value === 'fiat') {
                        list = list.filter(code => rates.value[code].type !== 'crypto');
                    } else if (currencyFilter.value === 'crypto') {
                        list = list.filter(code => rates.value[code].type === 'crypto');
                    }

                    // æœå°‹éæ¿¾
                    if (q) {
                        list = list.filter(code => {
                            const meta = rates.value[code];
                            return code.toLowerCase().includes(q) ||
                                   (meta.name && meta.name.includes(q)) ||
                                   (meta.nameEn && meta.nameEn.toLowerCase().includes(q));
                        });
                    }

                    // æ’é™¤å·²é¸æ“‡çš„è²¨å¹£
                    if (modalMode.value === 'add') {
                        const selectedSet = new Set([sourceCurrency.value, ...targetCurrencies.value]);
                        list = list.filter(code => !selectedSet.has(code));
                    }

                    return list.map(code => ({ code, ...rates.value[code] }));
                });

                const saveState = () => { if(undoStack.value.length > 20) undoStack.value.shift(); undoStack.value.push({ inputDisplay: inputDisplay.value, expressionAccumulator: expressionAccumulator.value, shouldResetScreen: shouldResetScreen.value }); };
                const undo = () => { if(undoStack.value.length === 0) return; const s = undoStack.value.pop(); inputDisplay.value = s.inputDisplay; expressionAccumulator.value = s.expressionAccumulator; shouldResetScreen.value = s.shouldResetScreen; };
                const fullExpressionDisplay = computed(() => expressionAccumulator.value + (inputDisplay.value && !shouldResetScreen.value ? inputDisplay.value : ''));
                
                const realTimeResultDisplay = computed(() => {
                    if (!expressionAccumulator.value && !inputDisplay.value) return '0';
                    let expr = expressionAccumulator.value + (inputDisplay.value || '');
                    const cleanExpr = expr.replace(/[+\-*/%Ã—Ã·\s]+$/, '').replace(/Ã—/g, '*').replace(/Ã·/g, '/');
                    try { return cleanExpr ? parseFloat(math.evaluate(cleanExpr).toFixed(6)).toString() : (inputDisplay.value || '0'); } catch(e){ return inputDisplay.value || '0'; }
                });

                const calculateTargetValue = (targetCode) => {
                    const amount = parseFloat(realTimeResultDisplay.value) || 0;
                    if (amount === 0) return '0';

                    const res = (amount / getRate(sourceCurrency.value)) * getRate(targetCode);

                    // åˆ¤æ–·æ˜¯å¦ç‚ºåŠ å¯†è²¨å¹£ï¼Œæ±ºå®šç²¾åº¦
                    const targetCurrency = rates.value[targetCode];
                    const isCrypto = targetCurrency?.type === 'crypto';

                    if (isCrypto) {
                        // åŠ å¯†è²¨å¹£ï¼šæ ¹æ“šæ•¸å€¼å¤§å°å‹•æ…‹èª¿æ•´ç²¾åº¦
                        if (res >= 1000) {
                            return currency(res, { symbol: '', precision: 2 }).format();
                        } else if (res >= 1) {
                            return currency(res, { symbol: '', precision: 4 }).format();
                        } else {
                            return currency(res, { symbol: '', precision: 8 }).format();
                        }
                    } else {
                        // æ³•å¹£ï¼š2 ä½å°æ•¸
                        return currency(res, { symbol: '', precision: 2 }).format();
                    }
                };

                const targetListDisplay = computed(() => {
                    return targetCurrencies.value.map(code => ({
                        code,
                        flag: getFlag(code),
                        rateDisplay: (getRate(code) / getRate(sourceCurrency.value)).toFixed(3),
                        valueDisplay: calculateTargetValue(code)
                    }));
                });

                const handleAC = () => { saveState(); if (!inputDisplay.value || inputDisplay.value === '0') { expressionAccumulator.value = ''; shouldResetScreen.value = false; } inputDisplay.value = ''; };
                const isAC = computed(() => !inputDisplay.value || inputDisplay.value === '0');
                const backspace = () => { saveState(); if(!shouldResetScreen.value && inputDisplay.value.length > 0) inputDisplay.value = inputDisplay.value.slice(0, -1); };
                const appendNumber = (n) => { saveState(); if(shouldResetScreen.value){ inputDisplay.value=''; shouldResetScreen.value=false; if(!expressionAccumulator.value.endsWith(' ')) expressionAccumulator.value=''; } if(n==='.'&&inputDisplay.value.includes('.'))return; if(inputDisplay.value==='0'&&n!=='.'){ if(n!=='0'&&n!=='00') inputDisplay.value=n; } else if(inputDisplay.value.length<12) inputDisplay.value+=n; };
                const getOp = (op) => op==='*'?'Ã—':op==='/'?'Ã·':op;
                const appendOperator = (op) => { saveState(); const s = getOp(op); if(!inputDisplay.value && expressionAccumulator.value) { expressionAccumulator.value = expressionAccumulator.value.trimEnd().slice(0, -1).trimEnd() + ` ${s} `; return; } expressionAccumulator.value += `${inputDisplay.value} ${s} `; inputDisplay.value = ''; shouldResetScreen.value = false; };
                const applyPercentage = () => { saveState(); const v = parseFloat(inputDisplay.value); if(isNaN(v)) return; const expr = expressionAccumulator.value.trim(); let nv = 0; if(expr.endsWith('+')||expr.endsWith('-')) { const lastOp = Math.max(expr.lastIndexOf('+'), expr.lastIndexOf('-')); try { const prev = math.evaluate(expr.substring(0, lastOp).replace(/Ã—/g,'*').replace(/Ã·/g,'/')); nv = prev * (v/100); } catch(e){} } else { nv = v/100; } inputDisplay.value = parseFloat(nv.toFixed(6)).toString(); };
                
                const addToHistory = (f, r) => { history.value.unshift({ time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), formula: f, result: r, resultFormatted: currency(r, {symbol:'', precision:2}).format() }); if(history.value.length>50) history.value.pop(); };

                const calculateFinal = () => {
                    saveState();
                    const finalExpr = expressionAccumulator.value + inputDisplay.value;
                    try {
                        const res = math.evaluate(finalExpr.replace(/Ã—/g, '*').replace(/Ã·/g, '/'));
                        addToHistory(finalExpr, res);
                        expressionAccumulator.value = '';
                        inputDisplay.value = parseFloat(res.toFixed(6)).toString();
                        shouldResetScreen.value = true;
                    } catch(e) {}
                };

                const clear = () => { saveState(); inputDisplay.value=''; expressionAccumulator.value=''; shouldResetScreen.value=false; };

                const openModal = (m) => { modalMode.value = m; searchQuery.value = ''; isModalOpen.value = true; nextTick(() => searchInput.value?.focus()); };
                
                const openSourceSelector = () => openModal('source');
                const openAddSelector = () => openModal('add');
                const openInfo = () => isInfoOpen.value = true;
                const openHistory = () => isHistoryOpen.value = true;

                const openAddModal = () => openModal('add');
                const selectCurrency = (c) => { 
                    if(modalMode.value === 'source') { if(targetCurrencies.value.includes(c)) targetCurrencies.value[targetCurrencies.value.indexOf(c)] = sourceCurrency.value; sourceCurrency.value = c; inputDisplay.value=''; expressionAccumulator.value=''; }
                    else if(c !== sourceCurrency.value && !targetCurrencies.value.includes(c)) targetCurrencies.value.push(c);
                    isModalOpen.value = false; 
                };
                const removeTarget = (i) => {
                    targetCurrencies.value.splice(i, 1);
                };
                const swapToSource = (i) => { 
                    if (deleteConfirmIndex.value !== null) {
                        deleteConfirmIndex.value = null;
                        if (deleteResetTimer) clearTimeout(deleteResetTimer);
                        return;
                    }
                    saveState(); const newSrc = targetCurrencies.value[i]; const newVal = calculateTargetValue(newSrc).replace(/,/g,''); targetCurrencies.value[i] = sourceCurrency.value; sourceCurrency.value = newSrc; inputDisplay.value = newVal; expressionAccumulator.value=''; shouldResetScreen.value=true; 
                };

                const handleClearHistory = () => { if(confirmDelete.value){ history.value=[]; confirmDelete.value=false; } else { confirmDelete.value=true; setTimeout(()=>confirmDelete.value=false, 3000); }};
                const useHistoryItem = (r) => { saveState(); inputDisplay.value=String(r); isHistoryOpen.value=false; shouldResetScreen.value=true; expressionAccumulator.value=''; };
                
                const triggerToast = (msg) => { toastMessage.value = msg; showToast.value = true; setTimeout(() => showToast.value = false, 2000); };
                const copyResult = () => {
                    const val = realTimeResultDisplay.value;
                    if(val === '0' && !inputDisplay.value) return; 
                    navigator.clipboard.writeText(val).then(() => {
                        triggerToast('å·²è¤‡è£½');
                    }).catch(err => console.error(err));
                };

                // Scroll Logic
                const checkScroll = () => {
                    const el = listContainer.value;
                    if (!el) return;
                    canScrollUp.value = el.scrollTop > 1;
                    canScrollDown.value = el.scrollTop + el.clientHeight < el.scrollHeight - 1;
                };

                const handleListScroll = () => {
                    checkScroll();
                };

                const scrollList = (direction) => {
                    const el = listContainer.value;
                    if (!el) return;
                    const scrollAmount = el.clientHeight / 2;
                    el.scrollBy({
                        top: direction === 'up' ? -scrollAmount : scrollAmount,
                        behavior: 'smooth'
                    });
                };

                watch(targetCurrencies, () => {
                    nextTick(checkScroll);
                }, { deep: true });

                onMounted(async () => {
                    await fetchRates();        // è¼‰å…¥æ³•å¹£
                    await fetchCryptoRates();  // è¼‰å…¥åŠ å¯†è²¨å¹£
                    window.addEventListener('resize', checkScroll);
                });

                return {
                    rates, lastUpdated, isLoading, showToast, toastMessage, isDarkMode, toggleTheme,
                    sourceCurrency, targetCurrencies, inputDisplay, expressionAccumulator, fullExpressionDisplay, realTimeResultDisplay,
                    isModalOpen, isInfoOpen, isHistoryOpen, searchQuery, currencyFilter, filteredCurrencies, searchInput,
                    history, confirmDelete, undo, canUndo, isAC,
                    openModal, openAddModal, selectCurrency, swapToSource, removeTarget, calculateTargetValue, getFlag, getRate,
                    appendNumber, appendOperator, calculateFinal, clear, backspace, applyPercentage, handleAC, handleClearHistory, useHistoryItem,
                    openSourceSelector, openAddSelector, openInfo, openHistory, sourceFlag, sourceName, hasHistory, targetListDisplay,
                    copyResult,
                    deleteConfirmIndex, triggerDelete,
                    listContainer, canScrollUp, canScrollDown, scrollList, handleListScroll
                };
            }
        }).mount('#app');
    </script>
</body>
</html><!-- Updated at Sun Dec 21 14:14:18 CST 2025 -->
